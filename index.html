<!DOCTYPE html>
<html>
<head>
    <title>Footnote Click Counter</title>
</head>
<body>
    <p>This is some text with a <a href="#" id="footnote">footnote</a>.</p>
    <p>Clicks on the footnote: <span id="count">0</span></p>

    <script>
        let count = 0;
        const footnote = document.getElementById('footnote');
        const countDisplay = document.getElementById('count');

        footnote.addEventListener('click', function() {
            count++;
            countDisplay.textContent = count;
        });
    </script>
</body>
</html>

<html>
    <head>
        
        
    
        
        <meta charset="utf-8">

        <title>CENTURY 21 eviction</title>

        <!-- Load external CSS styles -->
        <link rel="stylesheet" href="styles.css">

    </head>

    <body>

        <h1> ************copywrite date 10/13/2025********* </h1>
        <h2> ************buiessess name: CENTURY 21 Real Estate Unlawful Detainer*********<h/2>

        <!-- Load external JavaScript -->
        <script src="scripts.js"></script>
        
    </body>

</html>


<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Stripe SSA Demo</title>
<style>
:root{--bg:#f6f7fb;--card:#fff;--accent:#b80606;--muted:#64748b}
body{font-family:Inter,system-ui,Arial;background:var(--bg);margin:0;color:#0b1220;padding:28px}
.container{max-width:980px;margin:0 auto}
.card{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 8px 30px rgba(11,18,30,.06)}
h3{color:var(--accent);margin:0 0 12px 0}
.row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
label{font-weight:600;margin-right:8px}
.input,select{padding:10px;border-radius:8px;border:1px solid #e6eef8}
.button{background:var(--accent);color:#fff;padding:10px 14px;border-radius:8px;border:0;cursor:pointer}
.small{font-size:13px;color:var(--muted)}
.log{background:#0b12201a;padding:10px;border-radius:8px;font-family:monospace;max-height:140px;overflow:auto;border:1px solid #eef2f7}
.preview{margin-top:12px;padding:12px;border-radius:8px;border:1px dashed #e6eef8;background:#fcfcff}
</style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h3>Stripe Checkout + SSA Acceptance Demo</h3>

      <div class="row" style="margin-bottom:8px">
        <label>Flat Rate</label>
        <div style="font-weight:700">$10,000</div>
      </div>

      <div style="margin-bottom:12px">
        <input id="acceptSSA" type="checkbox" /> <label for="acceptSSA" class="small">I accept Stripe Services Agreement — <a href="https://stripe.com/legal/ssa" target="_blank">View SSA</a></label>
      </div>

      <div class="row">
        <button id="checkoutBtn" class="button">Pay $10,000 via Stripe Checkout</button>
        <button id="testCreate" class="button" style="background:#2546a8">Create Checkout Session (curl)</button>
        <div style="margin-left:auto" class="small">Use Stripe CLI to forward webhooks to local server</div>
      </div>

      <div class="preview" id="preview">
        <div><strong>Instructions</strong></div>
        <ol>
          <li class="small">Start your webhook-enabled server (see server example) at port 4242.</li>
          <li class="small">Expose Stripe webhooks locally using Stripe CLI: <code>stripe listen --forward-to localhost:4242/webhook</code></li>
          <li class="small">Serve this file via local static server: <code>npx http-server . -p 5500</code> then open <code>http://localhost:5500/stripe_ssa_demo.html</code></li>
          <li class="small">Click the Checkout button after accepting SSA; the demo will simulate a call to <code>/create-checkout-session</code>.</li>
        </ol>
      </div>

      <div style="margin-top:12px">
        <div class="small">Developer notes: Replace the client stub key with your publishable key and implement server endpoint <code>/create-checkout-session</code> to call Stripe using your secret key. Record SSA acceptance server-side with timestamp and user metadata before creating a session.</div>
      </div>

      <div style="margin-top:12px">
        <div><strong>Demo log</strong></div>
        <div id="log" class="log">Ready.</div>
      </div>
    </div>
  </div>

<script>
// Replace with your publishable key for real tests
const STRIPE_PUBLISHABLE_KEY = 'pk_test_REPLACE_ME';

function log(msg){ const el = document.getElementById('log'); el.innerText = `[${new Date().toLocaleTimeString()}] ${msg}\n` + el.innerText; }

document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
  const accepted = document.getElementById('acceptSSA').checked;
  if(!accepted){ alert('You must accept the Stripe Services Agreement to proceed.'); return; }
  log('Requesting /create-checkout-session (demo).');
  try{
    // Demo stub: call server endpoint that must create a Checkout Session and return sessionId
    const resp = await fetch('/create-checkout-session', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ amount: 1000000, currency: 'usd', ssAccepted: true, userMeta: { source: 'demo-ui' } })
    });
    if(!resp.ok) throw new Error('Server returned ' + resp.status);
    const data = await resp.json();
    log('Server returned sessionId: ' + (data.sessionId || data.session_id || 'n/a') );
    if(data.checkoutUrl){
      log('Opening Checkout URL (server-provided).');
      window.open(data.checkoutUrl, '_blank');
    } else {
      log('No checkoutUrl in response; use Stripe redirect on client with sessionId if provided.');
    }
  }catch(err){
    console.error(err);
    log('Failed to create session: ' + (err.message || err));
    alert('Demo: check server logs and Stripe CLI forwarding.');
  }
});

// Quick curl helper (opens instruction in new window)
document.getElementById('testCreate').addEventListener('click', ()=>{
  const curl = `curl -X POST http://localhost:4242/create-checkout-session -H "Content-Type: application/json" -d '{"amount":1000000,"currency":"usd","ssAccepted":true,"userMeta":{"userId":"demo"}}'`;
  alert('Run this in your terminal:\n\n' + curl);
});
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Image OCR Upload Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --accent:#b80606; --muted:#556072;
  --success:#0b9a5a; --warn:#e6a800; --danger:#c62828;
  --radius:12px; --shadow:0 8px 30px rgba(11,18,30,.06);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: linear-gradient(180deg,#f8fafc 0%, #f1f5f9 100%);
  color:#0b1220;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
  padding:28px;
}

.wrapper{max-width:980px;margin:0 auto}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
  overflow:hidden;
}

/* layout */
.grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
@media (max-width:880px){ .grid{grid-template-columns:1fr} }

/* controls */
.label{display:block;font-weight:600;margin:8px 0;color:#1f2937}
.input, input[type="file"], select, textarea{
  width:100%;
  padding:10px 12px;
  border:1px solid #e6eef8;
  border-radius:10px;
  background:transparent;
  font-size:14px;
}
.input:focus, input[type="file"]:focus{outline:none;border-color:var(--accent);box-shadow:0 6px 18px rgba(184,6,6,0.07)}

.row{display:flex;gap:10px;align-items:center}
.button{
  display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#fff;background:linear-gradient(180deg,var(--accent) 0%, #910404 100%);
}
.button.secondary{background:#334155}
.button.ghost{background:transparent;border:1px dashed #e6eef8;color:var(--accent)}

/* preview + mapped fields */
.preview{
  border:1px dashed #e6eef8;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfcff);min-height:140px;
}
.preview h4{margin:0 0 10px 0;font-size:13px;color:#334155}
.field{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-bottom:1px solid #f4f7fb}
.field:last-child{border-bottom:0}
.field .k{color:#334155;font-weight:700}
.field .v{color:#0b1220;max-width:70%;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* thumbnails */
.thumb-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.thumb{width:84px;height:84px;border-radius:8px;overflow:hidden;border:1px solid #e8eef8;background:#f8fafc;display:flex;align-items:center;justify-content:center}
.thumb img{max-width:100%;max-height:100%;object-fit:cover}

/* output & log */
.out, .log{background:#0b12201a;color:#0b1220;padding:10px;border-radius:10px;font-family:var(--mono);max-height:160px;overflow:auto;border:1px solid #eef2f7}
.note{font-size:13px;color:var(--muted);margin-top:8px}
.small{font-size:13px;color:var(--muted)}

/* utility */
.center{text-align:center}
.hidden{display:none}
</style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h2 style="margin:0;color:var(--accent);font-size:18px">Image OCR Upload Demo</h2>
        <div class="small">Source: Google Lens / Camera</div>
      </div>

      <div class="grid">
        <main>
          <label class="label">Upload image (Google Lens / Camera)</label>
          <input id="imgInput" class="input" type="file" accept="image/*" />
          <div id="thumbs" class="thumb-grid" aria-hidden="true"></div>

          <label class="label" style="margin-top:12px">Encryption passphrase (optional)</label>
          <input id="passphrase" class="input" type="password" placeholder="Type a passphrase to encrypt results locally" />

          <div class="row" style="margin-top:12px">
            <button id="uploadBtn" class="button">Upload & Process</button>
            <button id="encryptBtn" class="button secondary">Encrypt Locally</button>
            <button id="clearBtn" class="button ghost">Clear</button>
          </div>

          <div class="note">This demo sends a Base64 image to /process-image and shows mapped results and encrypted download options.</div>

          <div style="margin-top:12px">
            <label class="label">Raw response</label>
            <pre id="out" class="out">No output yet</pre>
          </div>
        </main>

        <aside>
          <div class="preview" id="preview">
            <h4>Mapped Fields</h4>
            <div class="field"><div class="k">Tenant</div><div class="v" id="mf-tenant">—</div></div>
            <div class="field"><div class="k">Property</div><div class="v" id="mf-address">—</div></div>
            <div class="field"><div class="k">Claim</div><div class="v" id="mf-claim">—</div></div>
            <div style="margin-top:10px" class="small">Confidence: <span id="mf-confidence">n/a</span></div>
          </div>

          <div style="margin-top:12px" class="log" id="log">No activity yet</div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
            <div class="small">Status: <strong id="procStatus">idle</strong></div>
            <div><button id="downloadEnc" class="button ghost">Download Encrypted</button></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

<script>
/* Minimal client upload logic with improved UX and optional client-side encryption */
async function toBase64(file){ return await new Promise(r=>{
  const fr=new FileReader(); fr.onload=()=>r(fr.result.split(',')[1]); fr.readAsDataURL(file);
}); }

function log(msg){
  const el = document.getElementById('log');
  const ts = new Date().toLocaleTimeString();
  el.innerText = `[${ts}] ${msg}\n` + el.innerText;
}

function showThumb(file){
  const thumbs = document.getElementById('thumbs');
  thumbs.innerHTML = '';
  const url = URL.createObjectURL(file);
  const d = document.createElement('div'); d.className = 'thumb';
  const img = document.createElement('img'); img.src = url; d.appendChild(img); thumbs.appendChild(d);
  thumbs.setAttribute('aria-hidden','false');
}

document.getElementById('imgInput').addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(f) { showThumb(f); log('Image selected: ' + f.name); }
});

document.getElementById('uploadBtn').addEventListener('click', async ()=>{
  const f = document.getElementById('imgInput').files[0];
  if(!f){ alert('Select an image'); return; }
  document.getElementById('procStatus').innerText = 'processing';
  log('Starting upload for ' + f.name);
  try{
    const b64 = await toBase64(f);
    const resp = await fetch('/process-image', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ filename: f.name, imageBase64: b64, userMeta: { source: 'google-lens' } })
    });
    if(!resp.ok) throw new Error('Server returned ' + resp.status);
    const data = await resp.json();
    document.getElementById('out').innerText = JSON.stringify(data, null, 2);
    if(data && data.mappedForm){
      document.getElementById('mf-tenant').innerText = data.mappedForm.tenantName || '—';
      document.getElementById('mf-address').innerText = data.mappedForm.propertyAddress || '—';
      document.getElementById('mf-claim').innerText = data.mappedForm.claimAmount || '—';
      document.getElementById('mf-confidence').innerText = (data.mappedForm.confidence || 'unknown');
    }
    log('Processing completed, id=' + (data && data.id ? data.id : 'n/a'));
    document.getElementById('procStatus').innerText = 'done';
  }catch(err){
    console.error(err);
    log('Upload failed: ' + (err.message||err));
    document.getElementById('procStatus').innerText = 'error';
  }
});

document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const outText = document.getElementById('out').innerText;
  if(!outText || outText === 'No output yet'){ alert('No data to encrypt'); return; }
  const pass = document.getElementById('passphrase').value;
  if(!pass){ if(!confirm('No passphrase provided. Continue without encryption?')) return; }
  try{
    const enc = new TextEncoder().encode(pass || 'demo-pass');
    const keyMaterial = await crypto.subtle.importKey('raw', enc, 'PBKDF2', false, ['deriveKey']);
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const key = await crypto.subtle.deriveKey({name:'PBKDF2', salt, iterations:250000, hash:'SHA-256'}, keyMaterial, {name:'AES-GCM', length:256}, true, ['encrypt']);
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const cipher = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, new TextEncoder().encode(outText));
    const payload = {
      salt: Array.from(salt), iv: Array.from(iv), data: Array.from(new Uint8Array(cipher))
    };
    const blob = new Blob([JSON.stringify(payload)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'encrypted_payload.json'; a.click();
    log('Encrypted payload prepared for download (demo).');
  }catch(e){
    console.error(e); log('Encryption failed: ' + e.message);
  }
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('imgInput').value = '';
  document.getElementById('thumbs').innerHTML = '';
  document.getElementById('out').innerText = 'No output yet';
  document.getElementById('mf-tenant').innerText = '—';
  document.getElementById('mf-address').innerText = '—';
  document.getElementById('mf-claim').innerText = '—';
  document.getElementById('mf-confidence').innerText = 'n/a';
  document.getElementById('procStatus').innerText = 'idle';
  log('Cleared UI and state');
});

document.getElementById('downloadEnc').addEventListener('click', async ()=>{
  let id;
  try { id = (JSON.parse(document.getElementById('out').innerText || '{}') || {}).id; } catch(e){ id = null; }
  if(!id){ alert('No encrypted id available'); return; }
  try{
    const resp = await fetch('/encrypted/' + id);
    if(!resp.ok) throw new Error('Not found');
    const data = await resp.json();
    const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'server_encrypted_' + id + '.json'; a.click();
    log('Downloaded encrypted blob for id=' + id);
  }catch(e){
    log('Download failed: ' + e.message);
  }
});
</script>
</body>
</html>

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Image OCR Upload Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#f6f7fb; --card:#ffffff; --accent:#b80606; --muted:#556072;
  --success:#0b9a5a; --warn:#e6a800; --danger:#c62828;
  --radius:12px; --shadow:0 8px 30px rgba(11,18,30,.06);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  background: linear-gradient(180deg,#f8fafc 0%, #f1f5f9 100%);
  color:#0b1220;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
  padding:28px;
}

.wrapper{max-width:980px;margin:0 auto}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:20px;
  overflow:hidden;
}

/* layout */
.grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
@media (max-width:880px){ .grid{grid-template-columns:1fr} }

/* controls */
.label{display:block;font-weight:600;margin:8px 0;color:#1f2937}
.input, input[type="file"], select, textarea{
  width:100%;
  padding:10px 12px;
  border:1px solid #e6eef8;
  border-radius:10px;
  background:transparent;
  font-size:14px;
}
.input:focus, input[type="file"]:focus{outline:none;border-color:var(--accent);box-shadow:0 6px 18px rgba(184,6,6,0.07)}

.row{display:flex;gap:10px;align-items:center}
.button{
  display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700;color:#fff;background:linear-gradient(180deg,var(--accent) 0%, #910404 100%);
}
.button.secondary{background:#334155}
.button.ghost{background:transparent;border:1px dashed #e6eef8;color:var(--accent)}

/* preview + mapped fields */
.preview{
  border:1px dashed #e6eef8;padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfcff);min-height:140px;
}
.preview h4{margin:0 0 10px 0;font-size:13px;color:#334155}
.field{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-bottom:1px solid #f4f7fb}
.field:last-child{border-bottom:0}
.field .k{color:#334155;font-weight:700}
.field .v{color:#0b1220;max-width:70%;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* thumbnails */
.thumb-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
.thumb{width:84px;height:84px;border-radius:8px;overflow:hidden;border:1px solid #e8eef8;background:#f8fafc;display:flex;align-items:center;justify-content:center}
.thumb img{max-width:100%;max-height:100%;object-fit:cover}

/* output & log */
.out, .log{background:#0b12201a;color:#0b1220;padding:10px;border-radius:10px;font-family:var(--mono);max-height:160px;overflow:auto;border:1px solid #eef2f7}
.note{font-size:13px;color:var(--muted);margin-top:8px}
.small{font-size:13px;color:var(--muted)}

/* utility */
.center{text-align:center}
.hidden{display:none}
</style>
</head>
<body>
  <div class="wrapper">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h2 style="margin:0;color:var(--accent);font-size:18px">Image OCR Upload Demo</h2>
        <div class="small">Source: Google Lens / Camera</div>
      </div>

      <div class="grid">
        <main>
          <label class="label">Upload image (Google Lens / Camera)</label>
          <input id="imgInput" class="input" type="file" accept="image/*" />
          <div id="thumbs" class="thumb-grid" aria-hidden="true"></div>

          <label class="label" style="margin-top:12px">Encryption passphrase (optional)</label>
          <input id="passphrase" class="input" type="password" placeholder="Type a passphrase to encrypt results locally" />

          <div class="row" style="margin-top:12px">
            <button id="uploadBtn" class="button">Upload & Process</button>
            <button id="encryptBtn" class="button secondary">Encrypt Locally</button>
            <button id="clearBtn" class="button ghost">Clear</button>
          </div>

          <div class="note">This demo sends a Base64 image to /process-image. Replace with HTTPS server and KMS in production.</div>

          <div style="margin-top:12px">
            <label class="label">Raw response</label>
            <pre id="out" class="out">No output yet</pre>
          </div>
        </main>

        <aside>
          <div class="preview" id="preview">
            <h4>Mapped Fields</h4>
            <div class="field"><div class="k">Tenant</div><div class="v" id="mf-tenant">—</div></div>
            <div class="field"><div class="k">Property</div><div class="v" id="mf-address">—</div></div>
            <div class="field"><div class="k">Claim</div><div class="v" id="mf-claim">—</div></div>
            <div style="margin-top:10px" class="small">Confidence: <span id="mf-confidence">n/a</span></div>
          </div>

          <div style="margin-top:12px" class="log" id="log">No activity yet</div>

          <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
            <div class="small">Status: <strong id="procStatus">idle</strong></div>
            <div><button id="downloadEnc" class="button ghost">Download Encrypted</button></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

<script>
/* Minimal client upload logic (unchanged behavior from your snippet) */
async function toBase64(file){ return await new Promise(r=>{
  const fr=new FileReader(); fr.onload=()=>r(fr.result.split(',')[1]); fr.readAsDataURL(file);
}); }

function log(msg){
  const el = document.getElementById('log');
  const ts = new Date().toLocaleTimeString();
  el.innerText = `[${ts}] ${msg}\n` + el.innerText;
}

function showThumb(file){
  const thumbs = document.getElementById('thumbs');
  thumbs.innerHTML = '';
  const url = URL.createObjectURL(file);
  const d = document.createElement('div'); d.className = 'thumb';
  const img = document.createElement('img'); img.src = url; d.appendChild(img); thumbs.appendChild(d);
  thumbs.setAttribute('aria-hidden','false');
}

document.getElementById('imgInput').addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(f) { showThumb(f); log('Image selected: ' + f.name); }
});

document.getElementById('uploadBtn').addEventListener('click', async ()=>{
  const f = document.getElementById('imgInput').files[0];
  if(!f){ alert('Select an image'); return; }
  document.getElementById('procStatus').innerText = 'processing';
  log('Starting upload for ' + f.name);
  try{
    const b64 = await toBase64(f);
    const resp = await fetch('/process-image', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ filename: f.name, imageBase64: b64, userMeta: { source: 'google-lens' } })
    });
    const data = await resp.json();
    document.getElementById('out').innerText = JSON.stringify(data, null, 2);
    if(data && data.mappedForm){
      document.getElementById('mf-tenant').innerText = data.mappedForm.tenantName || '—';
      document.getElementById('mf-address').innerText = data.mappedForm.propertyAddress || '—';
      document.getElementById('mf-claim').innerText = data.mappedForm.claimAmount || '—';
      document.getElementById('mf-confidence').innerText = (data.mappedForm.confidence || 'unknown');
    }
    log('Processing completed, id=' + (data && data.id ? data.id : 'n/a'));
    document.getElementById('procStatus').innerText = 'done';
  }catch(err){
    console.error(err);
    log('Upload failed: ' + (err.message||err));
    document.getElementById('procStatus').innerText = 'error';
  }
});

document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const out = document.getElementById('out').innerText;
  if(!out || out === 'No output yet'){ alert('No data to encrypt'); return; }
  const pass = document.getElementById('passphrase').value;
  if(!pass){ if(!confirm('No passphrase provided. Continue without encryption?')) return; }
  // Simple client-side AES-GCM encryption stub using Web Crypto (demo only)
  try{
    const enc = new TextEncoder().encode(pass || 'demo-pass');
    const keyMaterial = await crypto.subtle.importKey('raw', enc, 'PBKDF2', false, ['deriveKey']);
    const salt = crypto.getRandomValues(new Uint8Array(16));
    const key = await crypto.subtle.deriveKey({name:'PBKDF2', salt, iterations:250000, hash:'SHA-256'}, keyMaterial, {name:'AES-GCM', length:256}, true, ['encrypt']);
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const cipher = await crypto.subtle.encrypt({name:'AES-GCM', iv}, key, new TextEncoder().encode(out));
    const payload = {
      salt: Array.from(salt), iv: Array.from(iv), data: Array.from(new Uint8Array(cipher))
    };
    const blob = new Blob([JSON.stringify(payload)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'encrypted_payload.json'; a.click();
    log('Encrypted payload prepared for download (demo).');
  }catch(e){
    console.error(e); log('Encryption failed: ' + e.message);
  }
});

document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('imgInput').value = '';
  document.getElementById('thumbs').innerHTML = '';
  document.getElementById('out').innerText = 'No output yet';
  document.getElementById('mf-tenant').innerText = '—';
  document.getElementById('mf-address').innerText = '—';
  document.getElementById('mf-claim').innerText = '—';
  document.getElementById('mf-confidence').innerText = 'n/a';
  document.getElementById('procStatus').innerText = 'idle';
  log('Cleared UI and state');
});

document.getElementById('downloadEnc').addEventListener('click', async ()=>{
  const id = (JSON.parse(document.getElementById('out').innerText || '{}') || {}).id;
  if(!id){ alert('No encrypted id available'); return; }
  // request encrypted blob from server
  try{
    const resp = await fetch('/encrypted/' + id);
    if(!resp.ok) throw new Error('Not found');
    const data = await resp.json();
    const blob = new Blob([JSON.stringify(data)], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'server_encrypted_' + id + '.json'; a.click();
    log('Downloaded encrypted blob for id=' + id);
  }catch(e){
    log('Download failed: ' + e.message);
  }
});
</script>
</body>
</html>

<div class="container">
  <div class="card">
    <div class="h3">Image OCR & AI Mapping</div>
    <div class="grid">
      <div>
        <label class="label">Upload image (Google Lens / Camera)</label>
        <input id="imgInput" class="input" type="file" accept="image/*" />
        <div class="thumb-grid" id="thumbs"></div>

        <label class="label">Encryption passphrase (optional)</label>
        <input id="passphrase" class="input" type="password" />

        <div class="row" style="margin-top:12px">
          <button id="processBtn" class="button">Process Image</button>
          <button id="encryptBtn" class="button secondary">Encrypt & Store</button>
        </div>

        <div class="note">Server will run OCR → AI mapping → encrypt and return mapped form. Consent and SSA acceptance must be recorded server-side.</div>
      </div>

      <aside>
        <div class="preview" id="preview">
          <h4>Mapped Fields</h4>
          <div class="field"><div class="k">Tenant</div><div class="v" id="mf-tenant">—</div></div>
          <div class="field"><div class="k">Property</div><div class="v" id="mf-address">—</div></div>
          <div class="field"><div class="k">Claim</div><div class="v" id="mf-claim">—</div></div>
        </div>

        <div style="margin-top:12px" class="log" id="log">No activity yet</div>

        <div class="footer-actions">
          <div class="small">Status: <span class="badge pending" id="procStatus">Pending</span></div>
          <div><button id="downloadEnc" class="button ghost">Download Encrypted</button></div>
        </div>
      </aside>
    </div>
  </div>
</div>


:root{
  --bg:#f6f7fb; --card:#ffffff; --accent:#b80606; --muted:#556072;
  --success:#0b9a5a; --warn:#e6a800; --danger:#c62828;
  --glass: rgba(255,255,255,0.8);
  --radius:12px; --shadow:0 8px 30px rgba(11,18,30,.06);
  --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
}

/* Page layout */
body{
  margin:0;
  font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background: linear-gradient(180deg,#f8fafc 0%, #f1f5f9 100%);
  color:#0b1220;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;
  min-height:100vh;
}

.container{
  max-width:1080px;
  margin:32px auto;
  padding:20px;
}

/* Card */
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:18px;
  overflow:hidden;
}

/* Heading */
.h3{
  font-size:1.25rem;
  color:var(--accent);
  margin:0 0 12px 0;
  font-weight:700;
}

/* Grid */
.grid{
  display:grid;
  grid-template-columns: 1fr 420px;
  gap:16px;
}
@media (max-width:980px){
  .grid{grid-template-columns:1fr; padding:0}
}

/* Form inputs */
.label{display:block;font-weight:600;margin-bottom:6px;color:#1f2937}
.input, input[type="file"], select, textarea{
  width:100%;
  padding:10px 12px;
  border:1px solid #e6eef8;
  border-radius:10px;
  background:transparent;
  box-sizing:border-box;
  font-size:14px;
}
.input:focus, textarea:focus, select:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 4px 18px rgba(184,6,6,0.08);
}

/* Buttons */
.button{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:10px 14px;
  border-radius:10px;
  border:0;
  cursor:pointer;
  font-weight:700;
  color:#fff;
  background:linear-gradient(180deg,var(--accent) 0%, #910404 100%);
}
.button.secondary{
  background:#2d3748;
}
.button.ghost{
  background:transparent;
  color:var(--accent);
  border:1px dashed #f0dede;
}

/* Small helpers */
.note{font-size:13px;color:var(--muted);margin-top:8px}
.mono{font-family:var(--mono);font-size:13px;background:#0b12201a;padding:8px;border-radius:8px}
.row{display:flex;gap:10px;align-items:center}
.col{display:flex;flex-direction:column;gap:8px}

/* Preview / mapped form card */
.preview{
  border:1px dashed #e6eef8;
  padding:12px;border-radius:10px;background:linear-gradient(180deg,#fff,#fcfcff);
  min-height:120px;
}
.preview h4{margin:0 0 8px 0;font-size:13px}
.field{display:flex;justify-content:space-between;gap:12px;padding:8px 0;border-bottom:1px solid #f4f7fb}
.field:last-child{border-bottom:0}
.field .k{color:#334155;font-weight:700}
.field .v{color:#0b1220;max-width:70%;text-align:right;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}

/* Status badges */
.badge{display:inline-block;padding:6px 8px;border-radius:999px;font-weight:700;font-size:12px;color:#fff}
.badge.ok{background:var(--success)}
.badge.pending{background:var(--warn);color:#2b2b00}
.badge.halted{background:var(--danger)}

/* Log area */
.log{
  background:#0b12201a;color:#0b1220;padding:10px;border-radius:10px;font-family:var(--mono);
  max-height:160px;overflow:auto;border:1px solid #eef2f7;
}

/* File preview thumbnails */
.thumb-grid{display:flex;gap:8px;flex-wrap:wrap}
.thumb{
  width:86px;height:86px;border-radius:8px;overflow:hidden;border:1px solid #e8eef8;background:#f8fafc;display:flex;align-items:center;justify-content:center;
}
.thumb img{max-width:100%;max-height:100%;object-fit:cover}

/* Footer small actions */
.footer-actions{display:flex;gap:10px;align-items:center;margin-top:12px;justify-content:space-between}
.small{font-size:13px;color:var(--muted)}

/* Utility classes */
.hidden{display:none}
.center{text-align:center}
require('dotenv').config();
const express = require('express');
const bodyParser = require('body-parser');
const vision = require('@google-cloud/vision');
const crypto = require('crypto');
const { v4: uuidv4 } = require('uuid');

const client = new vision.ImageAnnotatorClient(); // ensure GOOGLE_APPLICATION_CREDENTIALS env set
const app = express();
app.use(bodyParser.json({limit:'10mb'}));

/* Simple in-memory store for demo */
const store = {};

/* Helper: basic AES-GCM encryption (use KMS in production) */
function encryptAesGcmJson(plaintextObj, passphrase){
  const iv = crypto.randomBytes(12);
  const salt = crypto.randomBytes(16);
  const key = crypto.pbkdf2Sync(passphrase, salt, 250000, 32, 'sha256');
  const cipher = crypto.createCipheriv('aes-256-gcm', key, iv);
  const json = Buffer.from(JSON.stringify(plaintextObj), 'utf8');
  const encrypted = Buffer.concat([cipher.update(json), cipher.final()]);
  const tag = cipher.getAuthTag();
  return { salt: salt.toString('base64'), iv: iv.toString('base64'), tag: tag.toString('base64'), data: encrypted.toString('base64') };
}

/* AI mapping stub: map OCR text to eviction form fields */
function aiMapOcrToForm(ocrText){
  // Replace with a real model / API call (structured prompt to LLM or specialized mapper)
  // Demo heuristics:
  const form = {};
  const lines = ocrText.split('\n').map(l=>l.trim()).filter(Boolean);
  for(const line of lines){
    if(line.match(/^\d{1,5}\s+\w+/)) form.propertyAddress = line;
    if(line.toLowerCase().includes('tenant') || line.match(/[A-Z][a-z]+\s[A-Z][a-z]+/)) form.tenantName = form.tenantName || line;
    if(line.match(/\$\s?\d+/)) form.claimAmount = line.match(/\$\s?[\d,]+/)[0];
  }
  // fallback placeholders
  form.tenantName = form.tenantName || 'Unknown Tenant';
  form.propertyAddress = form.propertyAddress || 'Unknown Address';
  form.claimAmount = form.claimAmount || '$10,000';
  return form;
}

/* POST /process-image
   Body: { filename, imageBase64, userMeta }
   Returns: { id, ocrText, mappedForm, encryptedBlobId (if stored) }
*/
app.post('/process-image', async (req, res) => {
  try {
    const { filename, imageBase64, userMeta } = req.body;
    if(!imageBase64) return res.status(400).json({ error: 'no image' });

    // 1) OCR using Google Vision
    const imageBuffer = Buffer.from(imageBase64, 'base64');
    const [result] = await client.textDetection({ image: { content: imageBuffer } });
    const ocrText = (result.fullTextAnnotation && result.fullTextAnnotation.text) || '';

    // 2) AI map OCR -> structured court form
    const mapped = aiMapOcrToForm(ocrText);

    // 3) Create audit record and optionally encrypt before storage
    const id = uuidv4();
    const audit = { id, filename, userMeta, processedAt: new Date().toISOString(), ocrSnippet: ocrText.slice(0,200) };
    // OPTIONAL: server-side encryption with KMS; demo: simple passphrase fallback
    const serverPass = process.env.SERVER_ENC_PASSPHRASE || 'demo-server-pass';
    const enc = encryptAesGcmJson({ mapped, audit }, serverPass);

    // Persist encrypted blob (demo in-memory)
    store[id] = { audit, mapped, encrypted: enc };

    // 4) Return structured data (minimal) and id reference
    return res.json({ id, mappedForm: mapped, encryptedBlobId: id, audit: { id: audit.id, processedAt: audit.processedAt } });
  } catch (err) {
    console.error(err);
    return res.status(500).json({ error: 'processing failed' });
  }
});

app.get('/encrypted/:id', (req,res)=>{
  const rec = store[req.params.id];
  if(!rec) return res.status(404).json({ error: 'not found' });
  res.json({ id: req.params.id, encrypted: rec.encrypted, audit: rec.audit });
});

app.listen(3000, ()=>console.log('server listening on 3000'));


<!-- Minimal client upload UI -->
<input id="imgInput" type="file" accept="image/*" />
<input id="passphrase" placeholder="Encryption passphrase (optional)" />
<button id="uploadBtn">Upload & Process</button>
<pre id="out"></pre>

<script>
async function toBase64(file){ return await new Promise(r=>{
  const fr=new FileReader(); fr.onload=()=>r(fr.result.split(',')[1]); fr.readAsDataURL(file);
}); }

document.getElementById('uploadBtn').addEventListener('click', async ()=>{
  const f = document.getElementById('imgInput').files[0];
  if(!f){ alert('Select an image'); return; }
  const b64 = await toBase64(f);
  const resp = await fetch('/process-image', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ filename: f.name, imageBase64: b64, userMeta: { source: 'google-lens' } })
  });
  const data = await resp.json();
  document.getElementById('out').innerText = JSON.stringify(data, null, 2);
  // Optional: If you want client-side encryption of returned structured data:
  // - run AES-GCM using passphrase and send encrypted blob to backend for storage
});
</script>


stripe listen --forward-to localhost:4242/webhook


curl -X POST http://localhost:4242/create-checkout-session \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 1000000,
    "currency": "usd",
    "ssAccepted": true,
    "userMeta": { "userId": "tester01", "email": "tester@example.com" }
  }'


# using a simple static server (optional but recommended)
npx http-server . -p 5500
# then open http://localhost:5500/stripe_ssa_demo.html


npm install
node server.js


<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Transaction History Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f6f7fb; --card:#fff; --accent:#b80606; --muted:#64748b;
    --ok:#0b9a5a; --warn:#e6a800; --err:#c62828;
  }
  body{font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);margin:0;color:#0b1220}
  .wrap{max-width:1100px;margin:28px auto;padding:20px}
  .card{background:var(--card);padding:18px;border-radius:10px;box-shadow:0 8px 30px rgba(11,18,30,.06)}
  h3{margin:0 0 12px;color:var(--accent)}
  .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:12px}
  .controls input[type=text], .controls select, .controls input[type=date]{padding:8px;border:1px solid #e6eef8;border-radius:8px}
  .controls button{background:var(--accent);color:white;border:0;padding:8px 12px;border-radius:8px;cursor:pointer}
  .row{display:flex;gap:12px;align-items:center}
  .table-wrap{overflow:auto;border-radius:8px;margin-top:12px;border:1px solid #eef2f7}
  table{width:100%;border-collapse:collapse;font-size:14px}
  th,td{padding:12px 10px;text-align:left;border-bottom:1px solid #f4f7fb;white-space:nowrap}
  th{background:#fbfdff;font-weight:700;color:#1f2937}
  .status{padding:6px 8px;border-radius:999px;color:white;font-weight:600;font-size:12px;display:inline-block}
  .status-paid{background:var(--ok)}
  .status-pending{background:var(--warn);color:#2b2b00}
  .status-halted{background:var(--err)}
  .pager{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:12px}
  .muted{color:var(--muted);font-size:13px}
  .mini{font-size:12px;color:#475569}
  .search-highlight{background:linear-gradient(90deg, #fff9c4, #fff);padding:2px 4px;border-radius:4px}
  .empty{padding:20px;text-align:center;color:var(--muted)}
  @media (max-width:760px){ th,td{padding:10px 6px} .controls{flex-direction:column;align-items:stretch} .pager{justify-content:center} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h3>Transaction History</h3>

      <div class="controls">
        <div class="row">
          <input id="search" type="text" placeholder="Search by tenant, invoice ID, or ud ID" style="min-width:280px"/>
          <select id="statusFilter">
            <option value="all">All statuses</option>
            <option value="pending">Pending</option>
            <option value="paid">Paid</option>
            <option value="halted">Halted</option>
          </select>
          <input id="fromDate" type="date" />
          <input id="toDate" type="date" />
        </div>

        <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <button id="refreshBtn">Refresh</button>
          <button id="exportBtn" style="background:#2546a8">Export CSV</button>
        </div>
      </div>

      <div id="tableContainer" class="table-wrap">
        <table id="txTable" aria-live="polite">
          <thead>
            <tr>
              <th>Date</th>
              <th>Invoice ID</th>
              <th>UD ID</th>
              <th>Tenant / Client</th>
              <th>Amount</th>
              <th>Payment Method</th>
              <th>Status</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody id="txBody"></tbody>
        </table>
      </div>

      <div class="pager">
        <div class="mini muted" id="summary">Showing 0 transactions</div>
        <button id="prevBtn" class="mini">Prev</button>
        <button id="nextBtn" class="mini">Next</button>
        <div class="mini muted">Page <span id="pageNum">1</span></div>
      </div>
    </div>
  </div>

<script>
/*
  Transaction History Demo JavaScript
  - Mock data + optional server fetch from /invoices and /ud endpoints
  - Search, filter, date range, pagination, CSV export
  - Simulated live update that pushes a random transaction every 18s
*/

// Configuration
const PAGE_SIZE = 8;
let transactions = [];   // array of tx objects
let page = 1;

// Utility: format date
function fmtDate(iso){ const d=new Date(iso); return d.toLocaleString(); }

// Utility: format currency
function fmtMoney(cents = 0){ return '$' + (cents/100).toFixed(2); }

// Mock dataset generator
function makeMockTx(i){
  const statuses = ['pending','paid','halted'];
  const methods = ['card','ach','wire','stripe'];
  const t = {
    date: new Date(Date.now() - Math.floor(Math.random()*20)*24*3600*1000 - i*60000).toISOString(),
    invoiceId: 'INV-' + (1000 + i),
    udId: 'UD-' + (5000 + i),
    tenant: ['Jane Doe','John Smith','Acme LLC','Valdez Properties'][i % 4],
    amount_cents: [1000000,1000000,250000,500000][i % 4], // $10k etc
    method: methods[i % methods.length],
    status: statuses[i % statuses.length],
    notes: (i % 5 === 0) ? 'Deed verified' : '',
  };
  return t;
}

// Initialize mock data
for (let i=0;i<36;i++) transactions.push(makeMockTx(i));

// Optional: fetch from server endpoints and merge results
async function fetchServerTransactions(){
  try {
    // Example: fetch invoice list from server (uncomment & adjust in production)
    // const resp = await fetch('/invoices'); const list = await resp.json();
    // Map server invoice shape into our transaction shape before merging
    // For demo, we skip actual server call.
    // If you want live server, ensure CORS and auth are configured.
    console.info('Server fetch skipped in demo; enable fetchServerTransactions() to pull real data.');
  } catch (err){
    console.warn('Server fetch failed', err);
  }
}

// Render table page
function render(){
  const tbody = document.getElementById('txBody');
  tbody.innerHTML = '';
  const search = document.getElementById('search').value.trim().toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;

  // filter
  let filtered = transactions.filter(tx => {
    if (statusFilter !== 'all' && tx.status !== statusFilter) return false;
    if (search){
      const hay = (tx.tenant + ' ' + tx.invoiceId + ' ' + tx.udId + ' ' + tx.notes).toLowerCase();
      if (!hay.includes(search)) return false;
    }
    if (from && new Date(tx.date) < new Date(from + 'T00:00:00')) return false;
    if (to && new Date(tx.date) > new Date(to + 'T23:59:59')) return false;
    return true;
  });

  const total = filtered.length;
  const pages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  if (page > pages) page = pages;
  const start = (page - 1) * PAGE_SIZE;
  const pageItems = filtered.slice(start, start + PAGE_SIZE);

  // populate rows
  if (pageItems.length === 0){
    tbody.innerHTML = '<tr><td class="empty" colspan="8">No transactions match the current filters.</td></tr>';
  } else {
    for (const tx of pageItems){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${fmtDate(tx.date)}</td>
        <td><span class="mini">${tx.invoiceId}</span></td>
        <td><span class="mini">${tx.udId}</span></td>
        <td>${highlight(tx.tenant, search)}</td>
        <td>${fmtMoney(tx.amount_cents)}</td>
        <td class="mini">${tx.method}</td>
        <td>${statusBadge(tx.status)}</td>
        <td class="mini">${highlight(tx.notes||'', search)}</td>
      `;
      tbody.appendChild(tr);
    }
  }

  document.getElementById('summary').innerText = `Showing ${Math.min(total, start+1)}–${Math.min(total, start + pageItems.length)} of ${total} transactions`;
  document.getElementById('pageNum').innerText = page;
}

// Helper: status badge
function statusBadge(s){
  const cls = (s === 'paid') ? 'status status-paid' : (s === 'pending') ? 'status status-pending' : 'status status-halted';
  return `<span class="${cls}">${s.toUpperCase()}</span>`;
}

// Helper: highlight search term in text
function highlight(text, term){
  if (!term) return text || '';
  const idx = text.toLowerCase().indexOf(term);
  if (idx === -1) return text;
  return text.substring(0, idx) + '<span class="search-highlight">' + text.substring(idx, idx+term.length) + '</span>' + text.substring(idx+term.length);
}

// Pagination buttons
document.getElementById('prevBtn').addEventListener('click', ()=>{
  if (page > 1) { page--; render(); }
});
document.getElementById('nextBtn').addEventListener('click', ()=>{
  page++; render();
});

// Controls
document.getElementById('search').addEventListener('input', ()=>{ page = 1; render(); });
document.getElementById('statusFilter').addEventListener('change', ()=>{ page = 1; render(); });
document.getElementById('fromDate').addEventListener('change', ()=>{ page = 1; render(); });
document.getElementById('toDate').addEventListener('change', ()=>{ page = 1; render(); });
document.getElementById('refreshBtn').addEventListener('click', async ()=>{
  await fetchServerTransactions();
  render();
});

// Export CSV
document.getElementById('exportBtn').addEventListener('click', ()=>{
  const header = ['date','invoiceId','udId','tenant','amount','method','status','notes'];
  // apply current filters
  const search = document.getElementById('search').value.trim().toLowerCase();
  const statusFilter = document.getElementById('statusFilter').value;
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;

  const rows = transactions.filter(tx => {
    if (statusFilter !== 'all' && tx.status !== statusFilter) return false;
    if (search){
      const hay = (tx.tenant + ' ' + tx.invoiceId + ' ' + tx.udId + ' ' + tx.notes).toLowerCase();
      if (!hay.includes(search)) return false;
    }
    if (from && new Date(tx.date) < new Date(from + 'T00:00:00')) return false;
    if (to && new Date(tx.date) > new Date(to + 'T23:59:59')) return false;
    return true;
  }).map(tx => [fmtDate(tx.date), tx.invoiceId, tx.udId, tx.tenant, (tx.amount_cents/100).toFixed(2), tx.method, tx.status, (tx.notes||'')]);

  const csvLines = [header.join(','), ...rows.map(r => r.map(escapeCsv).join(','))].join('\n');
  const blob = new Blob([csvLines], {type:'text/csv;charset=utf-8;'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `transactions_${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
});

// simple CSV escape
function escapeCsv(cell){
  if (cell === null || cell === undefined) return '';
  const s = String(cell);
  if (s.includes(',') || s.includes('"') || s.includes('\n')) return '"' + s.replace(/"/g,'""') + '"';
  return s;
}

// Simulated live update: push a random transaction every 18 seconds
setInterval(()=>{
  const i = Math.floor(Math.random()*9999);
  const tx = {
    date: new Date().toISOString(),
    invoiceId: 'INV-' + (20000 + i),
    udId: 'UD-' + (30000 + i),
    tenant: ['New Tenant','Auto Client','Remote LLC'][Math.floor(Math.random()*3)],
    amount_cents: 1000000,
    method: 'stripe',
    status: ['pending','paid','halted'][Math.floor(Math.random()*3)],
    notes: 'Auto-generated'
  };
  transactions.unshift(tx);
  // keep array bounded for demo
  if (transactions.length > 200) transactions.pop();
  console.info('Live update: new tx', tx.invoiceId);
  render();
}, 18000);

// Initial render
render();
</script>
</body>
</html>


require('dotenv').config();
const express = require('express');
const bodyParser = require('body-parser');
const Stripe = require('stripe');
const { v4: uuidv4 } = require('uuid');

const stripe = Stripe(process.env.STRIPE_SECRET_KEY);
const PORT = process.env.PORT || 4242;

const app = express();

/*
  Note: Stripe requires the raw body to validate webhook signature.
  We expose two body parsers: JSON for normal endpoints, raw for /webhook.
*/
app.use('/webhook', bodyParser.raw({ type: 'application/json' }));
app.use(bodyParser.json());

/*
  In-memory store for demo purposes.
  Replace with a persistent DB (Postgres, MySQL, MongoDB) in production.
*/
const db = {
  invoices: {},          // invoiceId => { invoiceId, amount, currency, ssAccepted, ssMeta, sessionId, status, createdAt }
  udProcesses: {},       // udId => { udId, status, invoiceId, updatedAt }
};

/*
  Helper: create demo UD process and invoice record
  In production, create these in DB after user sign up/checkout flow.
*/
function createInvoice({ amount, currency, ssAccepted, ssMeta }) {
  const invoiceId = uuidv4();
  const createdAt = new Date().toISOString();
  db.invoices[invoiceId] = {
    invoiceId,
    amount,
    currency,
    ssAccepted: !!ssAccepted,
    ssMeta: ssMeta || null,
    sessionId: null,
    status: 'pending',
    createdAt,
  };
  const udId = uuidv4();
  db.udProcesses[udId] = { udId, status: 'active', invoiceId, updatedAt: createdAt };
  return { invoiceId, udId };
}

/*
  POST /create-checkout-session
  Body: { invoiceId?, amount?, currency?, ssAccepted: true/false, userMeta: { userId, email } }
  Behavior:
    - requires ssAccepted === true
    - creates invoice if not provided
    - creates Stripe Checkout session and returns sessionId to client
    - stores sessionId server-side linked to invoice
*/
app.post('/create-checkout-session', async (req, res) => {
  try {
    const { invoiceId, amount = 1000000, currency = 'usd', ssAccepted, userMeta = {} } = req.body;

    if (!ssAccepted) {
      return res.status(400).json({ error: 'Stripe Services Agreement must be accepted.' });
    }

    // Create invoice and UD process if not passed
    let invId = invoiceId;
    if (!invId) {
      const created = createInvoice({ amount, currency, ssAccepted, ssMeta: { acceptedAt: new Date().toISOString(), userMeta } });
      invId = created.invoiceId;
    } else {
      // Update existing invoice SSA metadata
      if (!db.invoices[invId]) {
        return res.status(404).json({ error: 'Invoice not found.' });
      }
      db.invoices[invId].ssAccepted = true;
      db.invoices[invId].ssMeta = { acceptedAt: new Date().toISOString(), userMeta };
    }

    // Create a Checkout Session
    const session = await stripe.checkout.sessions.create({
      mode: 'payment',
      payment_method_types: ['card'],
      line_items: [
        {
          price_data: {
            currency,
            product_data: {
              name: 'Harbutte Unlawful Detainer Flat Rate',
              description: 'Flat rate legal processing fee'
            },
            unit_amount: amount
          },
          quantity: 1
        }
      ],
      metadata: { invoiceId: invId },
      success_url: `${process.env.BASE_URL}/success?session_id={CHECKOUT_SESSION_ID}`,
      cancel_url: `${process.env.BASE_URL}/cancel`
    });

    // Persist session id to invoice
    db.invoices[invId].sessionId = session.id;
    db.invoices[invId].status = 'checkout_created';
    return res.json({ sessionId: session.id, checkoutUrl: session.url });
  } catch (err) {
    console.error('create-checkout-session error', err);
    return res.status(500).json({ error: 'Internal server error' });
  }
});

/*
  POST /webhook
  Verifies Stripe signature and handles events.
  Important: endpoint receives raw body; we used bodyParser.raw for this path.
*/
app.post('/webhook', async (req, res) => {
  const sig = req.headers['stripe-signature'];
  const webhookSecret = process.env.STRIPE_WEBHOOK_SECRET;
  let event;

  try {
    event = stripe.webhooks.constructEvent(req.body, sig, webhookSecret);
  } catch (err) {
    console.error('⚠️  Webhook signature verification failed.', err.message);
    return res.status(400).send(`Webhook Error: ${err.message}`);
  }

  // Handle the event types we care about
  switch (event.type) {
    case 'checkout.session.completed': {
      const session = event.data.object;
      const invoiceId = session.metadata && session.metadata.invoiceId;
      if (invoiceId && db.invoices[invoiceId]) {
        db.invoices[invoiceId].status = 'paid';
        db.invoices[invoiceId].paidAt = new Date().toISOString();
        // Update associated UD process
        const ud = Object.values(db.udProcesses).find(u => u.invoiceId === invoiceId);
        if (ud) {
          ud.status = 'payment_received';
          ud.updatedAt = new Date().toISOString();
        }
        console.log(`Invoice ${invoiceId} marked paid via Checkout session ${session.id}`);
      } else {
        console.warn('checkout.session.completed: invoiceId not found in metadata');
      }
      break;
    }

    case 'payment_intent.succeeded': {
      const pi = event.data.object;
      // optional: map to invoice via metadata or lookup from payment_intent -> session -> metadata
      console.log(`PaymentIntent succeeded: ${pi.id}`);
      break;
    }

    default:
      console.log(`Unhandled event type ${event.type}`);
  }

  // Return 200 to acknowledge receipt of the event
  res.json({ received: true });
});

/*
  Minimal routes for demo inspection
*/
app.get('/invoices/:id', (req, res) => {
  const id = req.params.id;
  const inv = db.invoices[id];
  if (!inv) return res.status(404).json({ error: 'Not found' });
  return res.json(inv);
});

app.get('/ud/:id', (req, res) => {
  const id = req.params.id;
  const ud = db.udProcesses[id];
  if (!ud) return res.status(404).json({ error: 'Not found' });
  return res.json(ud);
});

app.get('/', (req, res) => res.send('Harbutte UD Demo Server running'));

/*
  Start server
*/
app.listen(PORT, () => {
  console.log(`Server listening on port ${PORT}`);
  console.log(`Ensure STRIPE_SECRET_KEY and STRIPE_WEBHOOK_SECRET are configured in environment`);
});


PORT=4242
STRIPE_SECRET_KEY=sk_test_...
STRIPE_PUBLISHABLE_KEY=pk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
BASE_URL=http://localhost:4242

{
  "name": "harbutte-ud-demo",
  "version": "1.0.0",
  "main": "server.js",
  "scripts": {
    "start": "node server.js"
  },
  "dependencies": {
    "body-parser": "^1.20.2",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "stripe": "^12.9.0",
    "uuid": "^9.0.0"
  }
}

<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Harbutte UD Demo — Stripe SSA Aware</title>
<style>
  :root{--accent:#b80606;--muted:#666;--bg:#f6f7fb}
  body{font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);margin:0;color:#111}
  .container{max-width:980px;margin:28px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 6px 30px rgba(11,14,22,.06)}
  h3{margin:.25rem 0 1rem;color:var(--accent)}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .col{flex:1;min-width:260px}
  label{display:block;font-weight:600;margin:8px 0 6px}
  input[type=text],input[type=password],input[type=file],select,textarea{width:100%;padding:10px;border:1px solid #dde2ee;border-radius:6px;box-sizing:border-box}
  button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.secondary{background:#2d3748}
  .note{font-size:13px;color:#666;margin-top:6px}
  .legal{font-size:13px;color:#333;background:#fff8; padding:8px;border-radius:6px;border:1px solid #eee}
  .log{background:#0b1220;color:#cfeaec;padding:10px;border-radius:6px;font-family:monospace;height:96px;overflow:auto}
  .status{padding:8px;border-radius:8px;margin-top:8px}
  .ok{background:#e6ffef;color:#054b24}
  .halt{background:#fff2f2;color:#7b0a0a}
  .small-link{color:var(--accent);text-decoration:underline;cursor:pointer}
</style>
</head>
<body>
<div class="container">
  <h3>Harbutte Unlawful Detainer Demo — Stripe Checkout added</h3>

  <div class="row">
    <div class="col">
      <label>Client Upload (Encrypted)</label>
      <input id="fileInput" type="file" multiple />
      <label>Encryption Passphrase</label>
      <input id="passphrase" type="password" value="demo-pass" />
      <div style="margin-top:8px">
        <button id="encryptBtn">Encrypt & Prepare</button>
        <button id="autoFillBtn" class="secondary">AI Auto-Fill Demo</button>
      </div>
      <div class="note">Files encrypted locally; production must hand off encrypted blobs and keys to server KMS or HSM, not localStorage.</div>
    </div>

    <div class="col">
      <label>Invoice and Payment</label>
      <div style="padding:12px;border:1px solid #eee;border-radius:8px;background:#fcfcff">
        <div><strong>Flat Rate</strong> <span style="display:inline-block;background:#eef2ff;padding:4px 8px;border-radius:8px;margin-left:8px">$10,000</span></div>
        <div class="note">Non-refundable; contractor must accept Stripe Services Agreement to proceed with Stripe payments.</div>
        <div style="margin-top:8px">
          <input type="checkbox" id="acceptSSA" />
          <label for="acceptSSA" style="display:inline-block;margin-left:8px" class="legal">
            I accept Stripe Services Agreement and Terms — <a href="https://stripe.com/legal/ssa" target="_blank">View SSA</a>.
          </label>
        </div>
        <div style="margin-top:12px">
          <button id="checkoutBtn">Pay $10,000 via Stripe Checkout</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Partial Payment Verification</label>
        <div style="display:flex;gap:8px">
          <input id="partialAmount" type="text" value="0.01" />
          <button id="verifyPartial">Simulate Partial Verification</button>
        </div>
        <div class="note">Verified $0.01 to OWNER's verified account halts UD processing. Real verification required server-side.</div>
      </div>

      <div id="processStatus" class="status ok">Process status: Active</div>
    </div>
  </div>

  <hr style="margin:18px 0" />

  <div class="row">
    <div class="col">
      <h3>Admin / Contractor Controls</h3>
      <label>Admin Token (demo)</label>
      <input id="adminToken" type="text" value="demo-token" />
      <div style="margin-top:8px"><button id="adminSave">Save Admin Token (Demo)</button></div>
      <div class="note">Record acceptance of SSA server-side with the admin token and user identity for legal traceability.</div>
    </div>

    <div class="col">
      <h3>Logs</h3>
      <div class="log" id="log"></div>
      <div style="margin-top:8px"><small>This demo references Stripe Services Agreement for your contractual responsibilities when using Stripe services.</small></div>
    </div>
  </div>
</div>

<!-- Load Stripe.js (client-only demo) -->
<script src="https://js.stripe.com/v3/"></script>
<script>
/* ===== Demo logger ===== */
const logEl = document.getElementById('log');
function log(msg){ const ts = new Date().toLocaleTimeString(); logEl.innerText = `[${ts}] ${msg}\n` + logEl.innerText; }

/* ===== Encryption placeholders (kept lightweight) ===== */
document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const files = document.getElementById('fileInput').files;
  if (!files.length){ log('No files selected.'); return; }
  log('Encrypting ' + files.length + ' file(s) (demo client-side).');
  // Demo: store file names only; production: encrypt and upload encrypted blobs to server KMS/HSM
  const names = Array.from(files).map(f=>f.name);
  localStorage.setItem('harbutte_file_names', JSON.stringify(names));
  log('Demo encrypted file metadata saved locally.');
});

/* ===== AI autofill simulation ===== */
document.getElementById('autoFillBtn').addEventListener('click', ()=>{
  const meta = JSON.parse(localStorage.getItem('harbutte_file_names') || 'null');
  if (!meta){ log('No encrypted data found for AI autofill.'); return; }
  // Simulate autofill
  const packet = {tenant:'Jane Doe', address:'123 Demo Ave, Stockton CA', amount:'$10,000', deedVerified:true};
  localStorage.setItem('demo_court_packet', JSON.stringify(packet));
  log('AI autofill simulated and packet stored (demo).');
});

/* ===== Stripe Checkout client integration (demo) ===== */
// NOTE: This client code calls a server endpoint /create-checkout-session which you must implement securely.
// The server must: create Stripe Checkout Session with your SECRET key, enforce SSA acceptance, store audit record, return sessionId.
const stripe = Stripe('YOUR_STRIPE_PUBLISHABLE_KEY'); // TODO: replace with your publishable key

document.getElementById('checkoutBtn').addEventListener('click', async ()=>{
  const acceptSSA = document.getElementById('acceptSSA').checked;
  if (!acceptSSA){
    alert('You must accept the Stripe Services Agreement to proceed with Stripe payments.');
    return;
  }
  log('Requesting Checkout session from server (demo).');
  // Demo: call a server endpoint to create Checkout session
  // Replace /create-checkout-session with your server endpoint that:
  //  - verifies SSA acceptance and records it server-side with timestamp and user id
  //  - creates Stripe Checkout Session for amount $10,000 USD
  //  - returns {sessionId}
  try {
    // Demo stub: simulate server response
    log('Simulating server-side Checkout session creation (demo).');
    // In production, use:
    // const resp = await fetch('/create-checkout-session', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({amount:1000000, currency:'usd', invoiceId:'INV123', acceptSSA:true})});
    // const data = await resp.json();
    // await stripe.redirectToCheckout({ sessionId: data.sessionId });
    alert('Demo: would redirect to Stripe Checkout. Implement server-side /create-checkout-session using Stripe secret key.');
    log('Checkout redirect simulated (demo). Server must validate SSA acceptance and create session with secret key.');
  } catch (err) {
    log('Error creating Checkout session: ' + (err.message || err));
  }
});

/* ===== Partial payment verification (simulated) ===== */
document.getElementById('verifyPartial').addEventListener('click', ()=>{
  const amt = parseFloat(document.getElementById('partialAmount').value || '0');
  log('Simulating verification for amount ' + amt.toFixed(2));
  if (Math.abs(amt - 0.01) < 0.0001){
    // Production: a server webhook should verify ACH/wire details and beneficiary match before marking process halted
    document.getElementById('processStatus').className = 'status halt';
    document.getElementById('processStatus').innerText = 'Process status: Halted';
    log('Process halted per $0.01 verified rule (demo). Server-side bank verification required in production.');
  } else {
    log('Amount does not meet $0.01 termination rule; no change.');
  }
});

/* ===== Admin token save (demo) ===== */
document.getElementById('adminSave').addEventListener('click', ()=>{
  const token = document.getElementById('adminToken').value;
  // Production: do not store tokens in localStorage; send to server and secure in DB
  localStorage.setItem('admin_token_demo', token);
  log('Admin token saved locally (demo). Record of SSA acceptance should be stored server-side for compliance.');
});

/* ===== Init log ===== */
log('Stripe Checkout client demo loaded. Read Stripe Services Agreement and incorporate SSA acceptance into server-side flow.');
</script>
</body>
</html>


<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Harbutte Unlawful Detainer Demo</title>
<style>
  :root{--accent:#b80606;--muted:#666;--bg:#f6f7fb}
  body{font-family:Inter,system-ui,Segoe UI,Arial;background:var(--bg);margin:0;color:#111}
  .container{max-width:980px;margin:28px auto;padding:20px;background:#fff;border-radius:10px;box-shadow:0 6px 30px rgba(11,14,22,.06)}
  h3{margin:.25rem 0 1rem;color:var(--accent)}
  .row{display:flex;gap:16px;flex-wrap:wrap}
  .col{flex:1;min-width:260px}
  label{display:block;font-weight:600;margin:8px 0 6px}
  input[type=text],input[type=password],input[type=file],select,textarea{width:100%;padding:10px;border:1px solid #dde2ee;border-radius:6px;box-sizing:border-box}
  button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;cursor:pointer}
  button.secondary{background:#2d3748}
  small{color:var(--muted)}
  .log{background:#0b1220;color:#cfeaec;padding:10px;border-radius:6px;font-family:monospace;height:96px;overflow:auto}
  .admin-box{border:1px dashed #ddd;padding:10px;border-radius:8px}
  .ad-slot{border:2px dashed #f0bf00;padding:12px;border-radius:8px;text-align:center;margin-top:8px}
  .status{padding:8px;border-radius:8px;margin-top:8px}
  .ok{background:#e6ffef;color:#054b24}
  .halt{background:#fff2f2;color:#7b0a0a}
  .badge{display:inline-block;padding:4px 8px;background:#eef2ff;border-radius:8px;color:#1e3a8a;margin-left:8px}
  .note{font-size:13px;color:#666;margin-top:6px}
</style>
</head>
<body>
<div class="container">
  <h3>Harbutte Unlawful Detainer Front-End Demo</h3>

  <div class="row">
    <div class="col">
      <label>Client Upload Encrypted Documents</label>
      <input id="fileInput" type="file" multiple />
      <label>Encryption Passphrase</label>
      <input id="passphrase" type="password" value="demo-pass" />
      <div style="margin-top:8px">
        <button id="encryptBtn">Encrypt & Prepare</button>
        <button id="autoFillBtn" class="secondary">AI Auto-Fill Demo</button>
      </div>
      <div class="note">Files are AES-GCM encrypted locally before any upload. Replace client-side storage with your secure back-end in production.</div>
    </div>

    <div class="col">
      <label>Invoice</label>
      <div style="padding:12px;border:1px solid #eee;border-radius:8px;background:#fcfcff">
        <div><strong>Flat Rate</strong> <span class="badge">$10,000</span></div>
        <div class="note">Non-refundable, paid prior to 72-hour court turnover. Partial payment rule: see Payment Control below.</div>
        <div style="margin-top:8px">
          <button id="payStripeBtn">Pay $10,000 via Stripe (Demo)</button>
          <button id="markPaidBtn" class="secondary">Mark as Paid (Demo Admin)</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Partial Payment Verification</label>
        <div style="display:flex;gap:8px">
          <input id="partialAmount" type="text" value="0.01" />
          <button id="verifyPartial">Simulate Partial Verification</button>
        </div>
        <div class="note">If verified payment of exactly $0.01 to OWNER's verified account is detected, the UD process stops immediately in this demo.</div>
      </div>

      <div id="processStatus" class="status ok">Process status: Active</div>
    </div>
  </div>

  <hr style="margin:18px 0" />

  <div class="row">
    <div class="col admin-box">
      <h3>Admin Login</h3>
      <label>Username</label><input id="adminUser" type="text" value="admin" />
      <label>Password</label><input id="adminPass" type="password" value="demo" />
      <div style="margin-top:8px"><button id="adminLogin">Login</button></div>
      <div id="adminArea" style="display:none;margin-top:12px">
        <label>Ad Space Sell Toggle</label>
        <div class="ad-slot" id="adSlot">Ad Slot Inactive</div>
        <div style="margin-top:8px"><button id="toggleAd">Toggle Ad Slot</button></div>
        <div style="margin-top:12px">
          <label>Admin Controls</label>
          <div style="display:flex;gap:8px">
            <button id="downloadEnc" class="secondary">Download Encrypted Files (Demo)</button>
            <button id="terminateProcess" class="secondary">Force Terminate UD</button>
          </div>
        </div>
      </div>
    </div>

    <div class="col">
      <h3>Logs</h3>
      <div class="log" id="log"></div>
      <div style="margin-top:8px"><small>Process server registration guidance for production teams is available from county resources; Sacramento county process server registration is an example reference.</small></div>
    </div>
  </div>
</div>

<script>
/* ===== Utilities: simple logger ===== */
const logEl = document.getElementById('log');
function log(msg){
  const ts = new Date().toLocaleTimeString();
  logEl.innerText = `[${ts}] ${msg}\n` + logEl.innerText;
}

/* ===== Crypto helpers (AES-GCM) for client-side demo only ===== */
async function deriveKey(passphrase, salt) {
  const enc = new TextEncoder();
  const keyMaterial = await crypto.subtle.importKey('raw', enc.encode(passphrase), 'PBKDF2', false, ['deriveKey']);
  return crypto.subtle.deriveKey(
    {name:'PBKDF2', salt: salt, iterations: 250_000, hash: 'SHA-256'},
    keyMaterial,
    {name:'AES-GCM', length:256},
    true,
    ['encrypt','decrypt']
  );
}

async function encryptFile(file, passphrase){
  const salt = crypto.getRandomValues(new Uint8Array(16));
  const iv = crypto.getRandomValues(new Uint8Array(12));
  const key = await deriveKey(passphrase, salt);
  const data = await file.arrayBuffer();
  const encrypted = await crypto.subtle.encrypt({name:'AES-GCM', iv: iv}, key, data);
  // return an object with salt and iv so decryption is possible with passphrase
  return {name: file.name, salt: Array.from(salt), iv: Array.from(iv), data: Array.from(new Uint8Array(encrypted))};
}

/* ===== File encryption flow ===== */
document.getElementById('encryptBtn').addEventListener('click', async ()=>{
  const files = document.getElementById('fileInput').files;
  const pass = document.getElementById('passphrase').value;
  if (!files.length){ log('No files selected.'); return; }
  log('Starting encryption of ' + files.length + ' file(s).');
  const out = [];
  for (let f of files){
    const enc = await encryptFile(f, pass);
    out.push(enc);
    log('Encrypted ' + f.name);
  }
  // Demo: store encrypted package to localStorage (production should send to backend)
  localStorage.setItem('harbutte_enc_pkg', JSON.stringify(out));
  log('Encrypted package saved to localStorage (demo).');
});

/* ===== Simulated AI autofill: decrypt then map fields ===== */
function simpleDecryptObject(obj, passphrase){
  // In this demo we do not actually decrypt binary back to text for simplicity.
  // Replace with proper decryption matching encryptFile when using server-side storage.
  if (!obj) return null;
  // Simulated extracted fields
  return {
    tenantName: "Jane Doe",
    propertyAddress: "123 Demo Ave, Stockton CA",
    claimAmount: "$10,000",
    deedVerified: true
  };
}
document.getElementById('autoFillBtn').addEventListener('click', ()=>{
  const enc = JSON.parse(localStorage.getItem('harbutte_enc_pkg') || 'null');
  if (!enc){ log('No encrypted package available for AI autofill.'); return; }
  log('Running AI autofill simulation on encrypted package.');
  const data = simpleDecryptObject(enc, document.getElementById('passphrase').value);
  if (!data){ log('Decryption failed or passphrase incorrect (demo).'); return; }
  // Map to a "court packet" object
  const packet = {
    tenant: data.tenantName,
    address: data.propertyAddress,
    claim: data.claimAmount,
    deedInHand: data.deedVerified
  };
  localStorage.setItem('demo_court_packet', JSON.stringify(packet));
  log('AI autofill completed and court packet prepared: ' + JSON.stringify(packet));
});

/* ===== Payment and Partial Verification Logic (Simulated) ===== */
let processActive = true;
function setProcessState(active, reason){
  processActive = active;
  const el = document.getElementById('processStatus');
  el.className = 'status ' + (active ? 'ok' : 'halt');
  el.innerText = active ? 'Process status: Active' : 'Process status: Halted';
  log('Process state changed: ' + (active ? 'Active' : 'Halted') + (reason ? (' — ' + reason) : ''));
}

document.getElementById('payStripeBtn').addEventListener('click', ()=>{
  // TODO: Replace with real Stripe Checkout or PaymentIntent server call
  log('Stripe payment flow initiated (demo). Replace with real Stripe integration server-side.');
  alert('Demo: redirecting to Stripe Checkout would occur here.');
});

document.getElementById('markPaidBtn').addEventListener('click', ()=>{
  localStorage.setItem('invoice_paid', 'true');
  log('Invoice marked as paid (demo admin action).');
  setProcessState(true, 'Payment received');
});

document.getElementById('verifyPartial').addEventListener('click', ()=>{
  const amt = parseFloat(document.getElementById('partialAmount').value || '0');
  log('Simulating partial payment verification for amount: ' + amt.toFixed(2));
  // Business rule as specified: if verified transfer of exactly 0.01 USD to OWNER verified account, stop process
  if (Math.abs(amt - 0.01) < 0.0001){
    // In production, here you must verify bank transfer receipt and beneficiary match via server-side banking APIs
    setProcessState(false, 'Verified $0.01 to OWNER account triggers UD process termination');
  } else {
    log('Partial payment does not meet termination rule; no change.');
  }
});

/* ===== Admin login & ad slot ===== */
document.getElementById('adminLogin').addEventListener('click', ()=>{
  const u = document.getElementById('adminUser').value;
  const p = document.getElementById('adminPass').value;
  // Demo credential check
  if (u === 'admin' && p === 'demo'){
    document.getElementById('adminArea').style.display = 'block';
    log('Admin login successful (demo).');
  } else {
    log('Admin login failed (demo).');
    alert('Admin login failed (demo). Use admin/demo.');
  }
});

document.getElementById('toggleAd').addEventListener('click', ()=>{
  const el = document.getElementById('adSlot');
  if (el.innerText.includes('Inactive')) {
    el.innerText = 'Ad Slot Active — Contact sales@harbutte.example';
    el.style.borderColor = '#0aa';
    log('Ad slot activated (demo).');
  } else {
    el.innerText = 'Ad Slot Inactive';
    el.style.borderColor = '#f0bf00';
    log('Ad slot deactivated (demo).');
  }
});

/* ===== Admin utilities ===== */
document.getElementById('downloadEnc').addEventListener('click', ()=>{
  const data = localStorage.getItem('harbutte_enc_pkg');
  if (!data){ log('No encrypted package to download.'); return; }
  const blob = new Blob([data], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'harbutte_encrypted_package.json';
  a.click();
  log('Encrypted package download started (demo).');
});

document.getElementById('terminateProcess').addEventListener('click', ()=>{
  setProcessState(false, 'Admin forced termination');
});

/* ===== Initialize ===== */
log('Demo ready. Remember to replace client-side stubs with secure server-side services and bank/payment webhooks.');
</script>
</body>
</html>


